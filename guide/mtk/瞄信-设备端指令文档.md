# 指令说明

设备端发送和接受指令的结构体均为dlinkmq_datapoint

* 设备端-指令结构体
```
typedef struct
{
    we_uint32   cmd_id; //指令ID,云端定义的设备功能点的唯一标识。
    we_uint16   msg_id; //数据点唯一标示。
    we_int8    	*cmd_value;  //数据点数据。
    we_uint32   cmd_value_type;  //cmd_value类型，1为bool, 2为number, 3为string(此参数为服务端做参考用，设备端无实际意义)。
    we_uint32   cmd_value_len;  //属性value的长度,数据长度
} dlinkmq_datapoint;
```
以音频录音指令--设备上报 为例，组一个指令结构体并发送：
```
dlinkmq_datapoint *datapoint = NULL;
datapoint=miaoxin_med_malloc(sizeof(dlinkmq_datapoint));
datapoint->cmd_value=miaoxin_med_malloc(14);

datapoint->cmd_id=52; //指令ID
datapoint->cmd_value="JDHVTYE520D,15"; //设备上报-音频文件信息
datapoint->cmd_value_len=14; //数据长度
datapoint->cmd_value_type=3; //数据类型
datapoint->msg_id=120152; //数据点唯一标示

//发送数据点
dlinkmq_publish(datapoint, on_send_message); //on_send_message是发送消息的回调函数
```
详细指令说明见[指令列表](#指令列表)

-----------------





##指令列表


### 1.音频实时监听指令
| 指令类型 | 指令ID | 数据类型 | 数据 | 描述 |
|----------|--------|----------|------|------|
| APP下发  | 1 | string | 电话号码。例：cmd_value="13222225325"表示设备拨号到13222225325 | 设备端收到这条指令后，设备CALL到手机 |
| 设备回复 | 1 | bool | 操作结果：成功0，失败1。例：cmd_value="0"表示设备操作成功 | 设备回复 |

* 示例:
```
dlinkmq_datapoint *datapoint = NULL;
datapoint=miaoxin_med_malloc(sizeof(dlinkmq_datapoint));
datapoint->cmd_value=miaoxin_med_malloc(1);

datapoint->cmd_id=1; //指令ID
datapoint->cmd_value="0"; //设备回复-操作成功
datapoint->cmd_value_len=1; //数据长度
datapoint->cmd_value_type=1; //数据类型
datapoint->msg_id=120101; //数据点唯一标示

//发送数据点
dlinkmq_publish(datapoint, on_send_message); //on_send_message是发送消息的回调函数

```




### 2.音频录音指令
| 指令类型 | 指令ID | 数据类型 | 数据 | 描述 |
|----------|--------|----------|------|------|
| APP下发  | 2 | bool | 无 |
| 设备回复 | 2 | bool | 操作结果：成功0，失败1。例：cmd_value="0"表示设备操作成功 | 设备回复 |
| 设备上报 | 52 | string | 语音文件存放地址/语音文件ID（数据通过dlinkmq_upload上传文件接口返回）,时长（单位：秒）。例：cmd_value="JDHVTYE520D,15"表示设备成功上传一份ID为JDHVTYE520D的音频文件到服务器，时长为15s

* 示例:
```
dlinkmq_datapoint *datapoint = NULL;
datapoint=miaoxin_med_malloc(sizeof(dlinkmq_datapoint));
datapoint->cmd_value=miaoxin_med_malloc(14);

datapoint->cmd_id=52; //指令ID
datapoint->cmd_value="JDHVTYE520D,15"; //设备上报-音频文件信息
datapoint->cmd_value_len=14; //数据长度
datapoint->cmd_value_type=3; //数据类型
datapoint->msg_id=120152; //数据点唯一标示

//发送数据点
dlinkmq_publish(datapoint, on_send_message); //on_send_message是发送消息的回调函数

```
以下指令类似


### 3.实时定位指令
| 指令类型 | 指令ID | 数据类型 | 数据 | 描述 |
|----------|--------|----------|------|------|
| APP下发  | 3 | number | 1开启，2关闭。例：cmd_value="1"开启设备实时定位功能 | app下发这条指令之后，设备端会实时定位一段时间(时间在在设置项设置)的位置信息上传 |
| 设备回复 | 3 | bool | 操作结果：成功0，失败1。例：cmd_value="0"表示成功 | 设备回复 |
| 设备上报 | 53 | string | 地理位置信息。 详细见附录 |




### 4.温度指令
| 指令类型 | 指令ID | 数据类型 | 数据 | 描述 |
|----------|--------|----------|------|------|
| APP下发  | 4 | bool | 无 | 用于实时获取数据，获取成功通过回复指令返回数据 |
| 设备回复 | 4 | string | 温度度数，设备操作/获取失败为空。例：cmd_value=""表示操作/获取失败 | 设备回复 |
| 设备上报 | 54 | string | 温度度数（单位：度）。例：cmd_value="36.5"表示温度为36.5度 |


### 5.运动数据指令
| 指令类型 | 指令ID | 数据类型 | 数据 | 描述 |
|----------|--------|----------|------|------|
| APP下发  | 5 | bool | 无 | 用于实时获取数据，获取成功通过回复指令返回数据 |
| 设备回复 | 5 | number | 运动步数，设备操作/获取失败为空。例：cmd_value=""表示获取失败 | 设备回复 |
| 设备上报 | 55 | number | 运动步数（单位：步）。例：cmd_value="666"表示当前运动步数为666步 |

### 6.睡眠数据上报指令
| 指令类型 | 指令ID | 数据类型 | 数据 | 描述 |
|----------|--------|----------|------|------|
| APP下发  | 6 | bool | 无 | 用于实时获取数据，获取成功通过回复指令返回数据 |
| 设备回复 | 6 | string | 睡眠质量数据，设备操作/获取失败为空。例：cmd_value="420,110"表示成功获取数据 | 设备回复 |
| 设备上报 | 56 | string | 睡眠时间（单位：分），数据格式为"深度睡眠时间,浅度睡眠时间"。例：cmd_value="420,120"，表示深度睡眠420分钟，浅度睡眠120分钟 | 

### 7.饮食数据指令
| 指令类型 | 指令ID | 数据类型 | 数据 | 描述 |
|----------|--------|----------|------|------|
| APP下发  | 7 | bool | 无 | 用于实时获取数据，获取成功通过回复指令返回数据 |
| 设备回复 | 7 | number | 饮食数据，设备操作/获取失败为空。例：cmd_value="0830,600" | 设备回复 |
| 设备上报 | 57 | number | 摄入卡路里（单位：卡路里）。例：cmd_value="2300"表示宠物当前摄入2300卡路里


### 8.设备电量指令
| 指令类型 | 指令ID | 数据类型 | 数据 | 描述 |
|----------|--------|----------|------|------|
| APP下发  | 8 | bool | 无 | 用于实时获取数据，获取成功通过回复指令返回数据 |
| 设备回复 | 8 | string | 设备电量，设备操作/获取失败为空 | 设备回复 |
| 设备上报 | 58 | string | 设备是否处于充电状态（1未充电,2充电），剩余电量(0-100)。例：cmd_value="1,80"表示未充电状态，剩余电量80% |

### 9.LED灯指令
| 指令类型 | 指令ID | 数据类型 | 数据 | 描述 |
|----------|--------|----------|------|------|
| APP下发  | 9 | number | app下发LED等效指令（0关闭灯效，1所有灯常亮，2交替亮）。例：cmd_value="2"表示设备开启LED灯，模式为交替亮 |  |
| 设备回复 | 9 | bool | 操作结果：成功0，失败1。例：cmd_value="0"表示成功 | 设备回复 |


### 10.位置信息指令
| 指令类型 | 指令ID | 数据类型 | 数据 | 描述 |
|----------|--------|----------|------|------|
| APP下发  | 10 | bool | 无 | 用于实时获取数据，获取成功通过回复指令返回数据,区别于实时定位，这个只定位一次并返回数据 |
| 设备回复 | 10 | string | 设备操作/获取失败为空，获取成功回复数据。例：cmd_value=""表示获取失败 | 设备回复 |







### 11.设置设备数据指令
| 指令类型 | 指令ID | 数据类型 | 数据 | 描述 |
|----------|--------|----------|------|------|
| APP下发 | 11 | string| 数据格式为：录音时长(单位：S),LED灯效报警时长(单位：S),报警电量值(0~100),设备上报数据时间间隔（单位：S）,实时定位时长（单位：S）。例：10,300,15,120,300 | APP设置页面的数据下发到设备端 |
| 设备回复 | 11 | bool | 操作结果：成功0，失败1。例：cmd_value="0"表示成功 | 设备回复 |


### 12.设置灯效报警时长
| 指令类型 | 指令ID | 数据类型 | 数据 | 描述 |
|----------|--------|----------|------|------|
| APP下发 | 12 | number| LED灯效报警时长(单位：S)。例：cmd_value="20"表示设置LED亮20秒 |
| 设备回复 | 12 | bool | 操作结果：成功0，失败1。例：cmd_value="0"表示成功 | 设备回复 |


### 13.设置低电量报警值
| 指令类型 | 指令ID | 数据类型 | 数据 | 描述 |
|----------|--------|----------|------|------|
| APP下发 | 13 | number| 报警电量值(0~100)。例：cmd_value="15"表示设置设备低电量报警值为15% |
| 设备回复 | 13 | bool | 操作结果：成功0，失败1。例：cmd_value="0"表示成功 | 设备回复 |


### 14.设置自动上报数据时间间隔
| 指令类型 | 指令ID | 数据类型 | 数据 | 描述 |
|----------|--------|----------|------|------|
| APP下发 | 14 | number| 设备上报数据时间间隔（单位：S）。例：cmd_value="600"表示设置设备自动上报数据时间间隔为600秒 |
| 设备回复 | 14 | bool | 操作结果：成功0，失败1。例：cmd_value="0"表示成功 | 设备回复 |


### 15.设置设备运动/睡眠模式（因设备不能同时获取两种数据）
| 指令类型 | 指令ID | 数据类型 | 数据 | 描述 |
|----------|--------|----------|------|------|
| APP下发 | 15 | number| 运动模式为：1，睡眠模式为：2。例：cmd_value="1"表示设置设备为运动模式，开启获取运动数据的开关 |
| 设备回复 | 15 | bool | 操作结果：成功0，失败1。例：cmd_value="0"表示成功 | 设备回复 |








##附录

* 位置数据说明

例：cmd_value="220414,134652,A,22.571707,N,113.8613968,E,0.1,0.0,100,7,60,90,1000,50,0000,4,1,460,0,9360,4082,131,9360,4092,148,9360,4091,143,9360,4153,141"。

| 名称 | 实例(ASII 码) | 说明
|----------|--------|----------|
| 日期 | 120414 | (日月年)2014 年4 月12 日
| 时间 | 101930 | (时分秒)10 点19 分30 秒
| 是否定位 | A | A:定位V:未定位
| 纬度 | 22.564025 | 按照DD.DDDDDD 格式定义, 此纬度值为:22.564025.
| 纬度标识 | N | N 表示北纬,S 表示南纬.
| 经度 | 113.242329 | 按照DDD.DDDDDD 格式定义, 此经度值:113.242329.
| 经度标识 | E | E 表示东经,W 表示西经
| 速度 | 5.21 | 5.21 公里/小时.
| 方向 | 152 | 方向在152 度.
| 海拔 | 100 | 单位为米
| 卫星个数 | 9 | 表明GPS 卫星个数
| GSM信号强度 | 100 | 表示当前GSM 信号强度(0-100)
| 电量 | 90 | 表示当前电量等级百分比
| 计步数 | 1000 | 计步数为1000
| 翻滚次数 | 50 | 翻滚50 次
| 终端状态 | 00000000 | 用十六进制字符串表示,含义如下:高16bit 表示报警,低16bit 表示状态.<br /><br />Bit 位(0 开始) 　含义(1 有效)<br />0 　　　　　　　低电状态<br />1 　　　　　　　出围栏状态<br />2 　　　　　　　进围栏状态<br />3 　　　　　　　设备状态<br />16　　　　　　　SOS 报警<br />17 　　　　　　　低电报警<br />18 　　　　　　　出围栏报警<br />19 　　　　　　　进围栏报警<br />20 　　　　　　　设备拆除报警
| 基站个数 | 4 | 上报基站个数,0 表示不上报基站信息
| 连接基站ta | 1 | GSM 时延
| MCC 国家码 | 460 | 460 代表中国
| MNC 网号 | 02 | 02 代表中国移动
| 连接基站位置区域码 | 10133 | 区域码
| 连接基站编号 | 5173 | 基站编号
| 连接基站信号强度 | 100 | 信号强度
| 附近基站1位置区域码 | 10133 | 区域码
| 附近基站1编号 | 5173 | 基站编号
| 附近基站1信号强度 | 100 | 信号强度
| 附近基站2位置区域码 | 10133 | 区域码
| 附近基站2 编号 | 5173 | 基站编号
| 附近基站2 信号强度 | 100 | 信号强度
| 附近基站3位置区域码 | 10133 | 区域码
| 附近基站3 编号 | 5173 | 基站编号
| 附近基站3 信号强度 | 100 | 信号强度
| … | … | …
| Wifi 信息数量 | 5 | Wifi 个数(最多5 个),按信号强度排序.
| Wifi 1 名字 | rrr | 第1 个wifi 信息名字
| Wifi 1 MAC 地址 | 1c:fa:68:13:a5:b4 | 第1 个wifi MAC 地址
| Wifi 1 信号强度 | -61 | 第1 个wifi 信号强度
| Wifi 1 名字 | abc | 第2 个wifi 名字
| Wifi 1 MAC 地址 | 1c:fa:68:13:a5:b5 | 第2 个wifi MAC 地址
| Wifi 1 信号强度 | -87 | 第2 个wifi 信号强度
| … | … | …
